"$schema" = "https://jj-vcs.github.io/jj/latest/config-schema.json"

[user]
name = "Jens Fredskov"
email = "jsfr@users.noreply.github.com"

[revset-aliases]
"closest_bookmark(to)" = 'heads(::to & (bookmarks() ~ (bookmarks(exact:"main") | bookmarks(exact:"master"))))'
"immutable_heads()" = "builtin_immutable_heads() | (remote_bookmarks() ~ mine())"

[aliases]
tug = ["bookmark", "move", "--from", "closest_bookmark(@-)", "--to", "@-"]
tug-trunk = ["bookmark", "move", "--from", "trunk()", "--to", "@-"]
f = ["git", "fetch"]
p = ["git", "push", "--allow-new"]
s = ["status"]
e = ["edit"]
d = ["diff"]
n = ["new"]
sq = ["squash"]
nt = ["new", "-r", "trunk()"]
rebase-trunk = ["rebase", "-b", "closest_bookmark(@)", "-d", "trunk()"]
lc = ["log", "-T", "builtin_log_compact"]
ai = [
  "util",
  "exec",
  "--",
  "/Users/jens/Repos/github.com/jsfr/jj-ai/build/jj-ai",
]
wip = ["util", "exec", "--", "bash", "-c", """
#!/usr/bin/env bash
# Toggle ‚ÄúWIP: ‚Äù prefix on the checked‚Äëout jujutsu commit message.
set -euo pipefail
 
prefix='üöß: '
 
desc=$(jj log -r @ -T 'description' --no-graph)
 
first=${desc%%$'\n'*}
rest=${desc#"$first"}
[[ "$rest" != "$desc" ]] && rest=${rest#$'\n'}
if [[ "$first" == "$prefix"* ]]; then
  first=${first#"$prefix"}
else
  first="${prefix}${first}"
fi
 
[[ -n "$rest" ]] && new_desc="$first"$'\n'"$rest" || new_desc="$first"
jj describe -m "$new_desc"
""", ""]
mergiraf = ["resolve", "--tool", "mergiraf"]

[ui]
default-command = "log"

[git]
auto-local-bookmark = true
# Prevent pushing work in progress
private-commits = "description(regex:'^(wip|(üöß)): .*')"

[template-aliases]
"format_timestamp(timestamp)" = "timestamp.ago()"

[templates]
# log_node = '''
#   label("node",
#     coalesce(
#       if(!self, label("elided", "~")),
#       if(current_working_copy, label("working_copy", "@")),
#       if(conflict, label("conflict", "√ó")),
#       if(immutable, label("immutable", "*")),
#       label("normal", "¬∑")
#     )
#   )
# '''
log = '''
  if(root,
    format_root_commit(self),
    label(if(current_working_copy, "working_copy"),
      concat(
        separate(" ",
          format_short_change_id_with_hidden_and_divergent_info(self),
          bookmarks,
          tags,
          working_copies,
          if(git_head, label("git_head", "HEAD")),
          if(conflict, label("conflict", "conflict")),
          if(empty, label("empty", "(empty)")),
          if(description,
            description.first_line(),
            label(if(empty, "empty"), description_placeholder),
          ),
        ) ++ "\n",
      ),
    )
  )
'''

# disable pagination for `jj status`, use `delta` for `jj diff` and `jj show`
[[--scope]]
--when.commands = ["status"]
[--scope.ui]
paginate = "never"

[[--scope]]
--when.commands = ["diff", "show"]
[--scope.ui]
pager = "delta"
diff-formatter = ":git"
